# BRC-33: PeerServ Message Relay Interface

Ty Everett (ty@projectbabbage.com)

## Abstract

We define a message box architecture and relay interface for exchanging data between two parties using a [BRC-31](./0031.md) authenticated server. This facilitates message exchange and forwarding between parties who may be offline or othewise unable to directly connect in a peer-to-peer manner due to NAT traversal or other obstacles.

## Motivation

The Bitcoin whitepaper states that no mechanism exists for exchanging a payment over a communication channel. However, NAT traversal and the lack of adoption for CGA and other systems impedes the development of such channels for the peer-to-peer exchange of general messages: The current internet is not condusive to peer-to-peer message exchange and does not provide a mechanism for exchanging these messages between peers reliably. This standard defines a solution that is based on the use of a [BRC-31](./0031.md) authenticated server, enabling a simple message box architecture and relay system between two peers who may not always be online.

## Specification

We start with a sender, a recipient and a server. The server enforces [BRC-31](./0031.md) authentication and identifies all parties (senders and recipients) based on their identity keys. The server exposes a few interfaces facilitating the delivery, receipt and acknowledgment of messages between the sender and the recipient, through various message boxes.

We specify that the server operates over HTTPS at an internet domain name. It enforces BRC-31 authentication for all requests. It implements the following three endpoints:

### POST `/sendMessage`

Use this route to send a message to a recipient's message box.

#### Parameters

```json
{
  "message": {
    "recipient": "028d37b941208cd6b8a4c28288eda5f2f16c2b3ab0fcb6d13c18b47fe37b971fc1",
    "messageBox": "payment_inbox",
    "body": "{}"
  }
}
```

#### Example Response

```json
{
  "status": "success"
}
```

### POST `/listMessages`

Use this route to list messages from your messageBox.

#### Parameters

- `messageBox`: The name of the messageBox you would like to list messages from.

#### Example Response

```json
{
  "status": "success",
  "messages": [
    {
      "messageId": 3301,
      "body": "{}",
      "sender": "028d37b941208cd6b8a4c28288eda5f2f16c2b3ab0fcb6d13c18b47fe37b971fc1"
    }
  ]
}
```

### POST `/acknowledgeMessage`

Use this route to acknowledge a message has been received.

#### Parameters

```json
{
  "messageIds": [
    3301
  ]
}
```

#### Example Response

```json
{
  "status": "success"
}
```

## Implementations

The message relay architecture has been implemented in the [PeerServ API](https://peerserv.babbage.systems), created by the Babbage Team.